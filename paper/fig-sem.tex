\begin{figure}
  \bookmark{Semantics of programs}
  \raggedright
  \noindent
  Suppose $\aRel_1:\aEvs_1\times\aEvs_1$ and $\aRel_2:\aEvs_2\times\aEvs_2$.

  We say $\aRel \rextendsdef{\aRel_1}{\aRel_2}$ if
  $\aRel\supseteq (\aRel_1\cup \aRel_2)$ and
  $\aRel\cap(\aEvs_1\times \aEvs_1) = \aRel_1$ and
  $\aRel\cap(\aEvs_2\times \aEvs_2) = \aRel_2$.
  \medskip
  
  \noindent
  If $\aPS\in\sSKIP$ then $\aEvs = \emptyset$ and
  $\aTr{\bEvs}{\bForm} \rimplies \bForm$.
  \medskip

  \noindent
  If $\aPS \in \sLPAR{\aPSS_1}{\aPSS_2}$ then  
  $(\exists\aPS_1\in\aPSS_1)$ $(\exists\aPS_2\in\aPSS_2)$
  \begin{multicols}{2}
    \begin{enumerate}[topsep=0pt,label=(\textsc{p}\arabic*),ref=\textsc{p}\arabic*]
    \item \label{par-E}
      $\aEvs = (\aEvs_1\uplus\aEvs_2)$,
    \item \label{par-lambda}
      ${\labeling}=\PBR{{\labeling_1}\cup {\labeling_2}}$, 
      \stepcounter{enumi}
    \item[] \labeltext[\textsc{p}3]{}{par-kappa}
      \begin{enumerate}[leftmargin=0pt]
      \item \label{par-kappa1}
        if $\aEv\in\aEvs_1$ then $\labelingForm(\aEv) \rimplies \labelingForm_1(\aEv)$,
      \item \label{par-kappa2}
        if $\aEv\in\aEvs_2$ then $\labelingForm(\aEv) \rimplies \labelingForm_2(\aEv)$,
      \end{enumerate}
    \item \label{par-tau}
      $\aTr{\bEvs}{\bForm} \rimplies \aTr[1]{\bEvs}{\bForm}$,
    \item \label{par-term}
      $\aTerm \rimplies \aTerm[1]\land\aTerm[2]$,
    \item \label{par-rf}
      ${\rrfx}\rextends{\rrfx_1}{\rrfx_2}$,
      \stepcounter{enumi}
    \item[] \labeltext[\textsc{p}7]{}{par-le}
      \begin{enumerate}[leftmargin=0pt]
      \item \label{par-le-extends}
        ${\le}\rextends{\le_1}{\le_2}$,
      \item \label{par-le-rf}
        % ${\rrfx}\subseteq\PBR{{\rrfx_1}\cup{\rrfx_2}\cup{\le}}$.
        % if $\bEv\xrfx\aEv$ then either $\bEv\xrfx_1\aEv$, $\bEv\xrfx_2\aEv$, or $\bEv\le\aEv$.
        if $\bEv\in\aEvs_1$, $\aEv\in\aEvs_2$ and $\bEv\xrfx\aEv$ then $\bEv\le\aEv$.
      \end{enumerate}
    \end{enumerate}
  \end{multicols}
  \medskip

  \noindent
  If $\aPS \in \sSEMI{\aPSS_1}{\aPSS_2}$ then $(\exists\aPS_1\in\aPSS_1)$
  $(\exists\aPS_2\in\aPSS_2)$\\
  let $\labelingForm'_2(\aEv)=\aTr[1]{\Cdown{\aEv}}{\labelingForm_2(\aEv})$,
  where
  $\Cdown{\aEv}=\{ \cEv \mid \cEv \lt \aEv \}$%, if $\labeling(\aEv)$ is a write, and $\Cdown{\aEv}=\aEvs_1$, otherwise
  % \begin{math}
  %   \Cdown{\aEv}=
  %   \begin{cases}
  %     \{ \cEv \mid \cEv \lt \aEv \} & \textif \labeling(\aEv) \;\text{is a write}
  %     \\
  %     \aEvs_1 & \textotherwise
  %   \end{cases}
  % \end{math}
  % let
  % \begin{math}
  %   \smash{
  %   \downarrow\aEv=\begin{cases}
  %     \{ \cEv \mid \cEv \lt \aEv \} &\textif \labeling(\aEv) \;\text{is a write}\\
  %     \aEvs_1 &\textotherwise
  %   \end{cases}}
  % \end{math}
  \begin{multicols}{2}
    \begin{enumerate}[topsep=0pt,label=(\textsc{s}\arabic*),ref=\textsc{s}\arabic*]
    \item \label{seq-E}
      $\aEvs = (\aEvs_1\cup\aEvs_2)$,
    \item \label{seq-lambda}
      ${\labeling}=\PBR{{\labeling_1}\cup {\labeling_2}}$, 
      \stepcounter{enumi}
    \item[] \labeltext[\textsc{s}3]{}{seq-kappa}
      \begin{enumerate}[leftmargin=0pt]
      \item \label{seq-kappa1}
        if $\aEv\in\aEvs_1\setminus\aEvs_2$ then $\labelingForm(\aEv) \rimplies \labelingForm_1(\aEv)$,
      \item \label{seq-kappa2}
        if $\aEv\in\aEvs_2\setminus\aEvs_1$ then $\labelingForm(\aEv) \rimplies \labelingForm'_2(\aEv)$,
      \item \label{seq-kappa12}
        % if $\aEv{\in}\aEvs_1{\cap}\aEvs_2$ then $\labelingForm(\aEv) \rimplies \labelingForm_1(\aEv){\lor}\labelingForm'_2(\aEv)$,\\
        if $\aEv\in\aEvs_1\cap\aEvs_2$ then $\labelingForm(\aEv) \rimplies \labelingForm_1(\aEv)\lor\labelingForm'_2(\aEv)$,
        % where
        % $\labelingForm'_2(\aEv)=\aTr[1]{\Cdown{\aEv}}{\labelingForm_2(\aEv})$,
        % where $\Cdown{\aEv}=\{ \cEv \mid \cEv \lt \aEv \}$ if $\labeling(\aEv)$
        % is a write, and $\Cdown{\aEv}=\aEvs_1$, otherwise,
      \item \label{seq-kappa-release}
        if $\labeling_2(\aEv)$ is a release then $\labelingForm(\aEv) \rimplies \aTerm[1]$,
      \end{enumerate}
    \item \label{seq-tau}
      $\aTr{\bEvs}{\bForm} \rimplies \aTr[1]{\bEvs}{\aTr[2]{\bEvs}{\bForm}}$,
    \item \label{seq-term}
      $\aTerm \rimplies \aTerm[1]\land\aTr[1]{}{\aTerm[2]}$,
    \item \label{seq-rf}
      ${\rrfx}\rextends{\rrfx_1}{\rrfx_2}$,
      \stepcounter{enumi}
    \item[] \labeltext[\textsc{s}7]{}{seq-le}
      \begin{enumerate}[leftmargin=0pt]
      \item \label{seq-le-extends}
        ${\le}\rextends{\le_1}{\le_2}$, 
      \item \label{seq-le-rf}
        if $\bEv\in\aEvs_1$, $\aEv\in\aEvs_2$ and $\bEv\xrfx\aEv$ then $\bEv\le\aEv$,
      \item \label{seq-le-delays}
        if $\labeling_1(\bEv) \rdelays \labeling_2(\aEv)$ then $\bEv\le\aEv$.
      \end{enumerate}
      %   % if $\cEv\in\aEvs_1$ and $(\bEv,\aEv)\in\PBR{{\rrfx}\cap(\aEvs_1\times \aEvs_2)}$ then 
      %   % either $\labeling(\cEv) \reorderca \labeling(\bEv)$
      %   % or $\cEv\le\bEv$,
    \end{enumerate}
  \end{multicols}
  \medskip

  \noindent
  If $\aPS \in \sIF{\aForm}\sTHEN\aPSS_1\sELSE\aPSS_2\sFI$ then
  $(\exists\aPS_1\in\aPSS_1)$ $(\exists\aPS_2\in\aPSS_2)$
  \begin{multicols}{2}
    \begin{enumerate}[topsep=0pt,label=(\textsc{c}\arabic*),ref=\textsc{c}\arabic*]
    \item \label{if-E}
      $\aEvs = (\aEvs_1\cup\aEvs_2)$,
    \item \label{if-lambda}
      ${\labeling}=\PBR{{\labeling_1}\cup {\labeling_2}}$, 
      % \item[(\ref{par-E}--\ref{par-le})] as for $\sLPAR{}{}$,
      \stepcounter{enumi}
    \item[] \labeltext[\textsc{c}3]{}{if-kappa}
      \begin{enumerate}[leftmargin=0pt]
      \item \label{if-kappa1}
        if $\aEv\in\aEvs_1\setminus\aEvs_2$ then $\labelingForm(\aEv) \rimplies \aForm\land\labelingForm_1(\aEv)$,
      \item \label{if-kappa2}
        if $\aEv\in\aEvs_2\setminus\aEvs_1$ then $\labelingForm(\aEv) \rimplies \neg\aForm\land\labelingForm_2(\aEv)$, 
      \item \label{if-kappa12}
        if $\aEv\in\aEvs_1\cap\aEvs_2$\\ then
        % $\labelingForm(\aEv) \rimplies (\aForm\limplies\labelingForm_1(\aEv))\land(\neg\aForm\limplies\labelingForm_2(\aEv))$,
        $\labelingForm(\aEv) \rimplies (\aForm\land\labelingForm_1(\aEv))\lor(\neg\aForm\land\labelingForm_2(\aEv))$,
      \end{enumerate}
    \item \label{if-tau}
      % $\aTr{\bEvs}{\bForm} \rimplies (\aForm\limplies\aTr[1]{\bEvs}{\bForm})\land(\neg\aForm\limplies\aTr[2]{\bEvs}{\bForm})$,
      $\aTr{\bEvs}{\bForm} \rimplies (\aForm\land\aTr[1]{\bEvs}{\bForm})\lor(\neg\aForm\land\aTr[2]{\bEvs}{\bForm})$,
    \item \label{if-term}
      % $\aTerm \rimplies (\aForm\limplies\aTerm[1])\land(\neg\aForm\limplies\aTerm[2])$.
      $\aTerm \rimplies (\aForm\land\aTerm[1])\lor(\neg\aForm\land\aTerm[2])$.
      \stepcounter{enumi}
    \item[] \labeltext[\textsc{c}6]{}{if-rf}
      \begin{enumerate}[leftmargin=0pt]
      \item \label{if-rf-extends}
        ${\rrfx}\rextends{\rrfx_1}{\rrfx_2}$,
      \item \label{if-rf-le}
        ${\rrfx}\rsubset{\rrfx_1}{\rrfx_2}$,
      \end{enumerate}
      \stepcounter{enumi}
    \item[] \labeltext[\textsc{c}7]{}{if-le}
      \begin{enumerate}[leftmargin=0pt]
        % \item \label{if-le-rf}
        %   if $\bEv\in\aEvs_1$ and $\aEv\in\aEvs_2$ and $\bEv\xrfx\aEv$ then $\bEv\le\aEv$,
      \item \label{if-le-extends}
        ${\le}\rextends{\le_1}{\le_2}$,
      \item \label{if-le-subset}
        ${\le}\rsubset{\le_1}{\le_2}$.
      \end{enumerate}
    \end{enumerate}
  \end{multicols}
  \medskip

  \noindent
  If $\aPS\in\sLET{\aReg}{\aExp}$ then $\aEvs = \emptyset$ and
  $\aTr{\bEvs}{\bForm} \rimplies \bForm[\aExp/\aReg]$.
  \medskip

  \noindent
  If $\aPS \in \sLOAD[\amode]{\aReg}[\ascope]{\aLoc}[\aThrd]$ then
  $(\exists\aVal\in\Val)$
  \begin{multicols}{2}
    \begin{enumerate}[topsep=0pt,label=(\textsc{r}\arabic*),ref=\textsc{r}\arabic*]
    \item \label{read-E}
      if $\bEv,\aEv\in\aEvs$ then $\bEv=\aEv$,
    \item \label{read-lambda}
      $\labelingAct(\aEv) = \DR[\amode]{\aLoc}[\ascope]{\aVal}[\aThrd]$,
      \stepcounter{enumi}
      \stepcounter{enumi}
    \item[] \labeltext[\textsc{r}4]{}{read-tau}
      \begin{enumerate}[leftmargin=0pt]
      \item \label{read-tau-dep}
        if $(\aEvs\cap\bEvs)\neq\emptyset$ then
        \begin{math}
          \aTr{\bEvs}{\bForm} \rimplies
          \aVal{=}\aReg
          \limplies \bForm
        \end{math},    
      \item \label{read-tau-ind}
        if $\aEvs\neq\emptyset$ and $(\aEvs\cap\bEvs)=\emptyset$ then
        \begin{math}
          \aTr{\bEvs}{\bForm} \rimplies
          \PBR{\aVal{=}\aReg \lor \aLoc{=}\aReg} \limplies
          \bForm,
        \end{math}
      \item \label{read-tau-empty}
        if $\aEvs=\emptyset$ then
        \begin{math}
          \aTr{\bEvs}{\bForm} \rimplies
          % \PBR{\aVal{=}\aReg \lor \aLoc{=}\aReg} \limplies
          \bForm,
        \end{math}
      \end{enumerate}
    \item \label{read-term}
      %if $\aEvs=\emptyset$ and $\amode\gemode\mACQ$ then $\aTerm \rimplies \FALSE$. 
      if $\aEvs=\emptyset$ and $\amode\neq\mRLX$ then $\aTerm \rimplies \FALSE$. 
    \end{enumerate}
  \end{multicols}
  \medskip

  \noindent
  If $\aPS \in \sSTORE[\amode]{\aLoc}[\ascope]{\aExp}[\aThrd]$ then
  $(\exists\aVal\in\Val)$
  \begin{multicols}{2}
    \begin{enumerate}[topsep=0pt,label=(\textsc{w}\arabic*),ref=\textsc{w}\arabic*]
    \item \label{write-E}
      if $\bEv,\aEv\in\aEvs$ then $\bEv=\aEv$,
    \item \label{write-lambda}
      $\labelingAct(\aEv) = \DW[\amode]{\aLoc}[\ascope]{\aVal}[\aThrd]$,
    \item \label{write-kappa}
      \begin{math}
        \labelingForm(\aEv) \rimplies
        \aExp{=}\aVal
      \end{math},    
    \item \label{write-tau}
      % if $(\aEvs\cap\bEvs)\neq\emptyset$ then
      \begin{math}
        \aTr{\bEvs}{\bForm} \rimplies 
        \bForm
        [\aExp/\aLoc]
        % \land\aExp{=}\aVal
      \end{math},
      \stepcounter{enumi}      
    \item[] \labeltext[\textsc{w}5]{}{write-term}
      \begin{enumerate}[leftmargin=0pt]
      \item \label{write-term-nonempty}
        if $\aEvs\neq\emptyset$ then $\aTerm \rimplies \aExp{=}\aVal$,
      \item \label{write-term-empty}
        if $\aEvs=\emptyset$ then $\aTerm \rimplies \FALSE$.
      \end{enumerate}
    \end{enumerate}
  \end{multicols}
  \medskip

  \noindent
  If $\aPS \in \sFENCE[\ascope]{\amode}[\aThrd]$ then
  % $(\exists\aLocs\subseteq\Loc)$
  % $(\exists\bmode\in\{\amode,\mRLX\})$
  \begin{multicols}{2}
    \begin{enumerate}[topsep=0pt,label=(\textsc{f}\arabic*),ref=\textsc{f}\arabic*]
    \item \label{fence-E}
      % $\aEvs\neq\emptyset$ and
      if $\bEv,\aEv\in\aEvs$ then $\bEv=\aEv$,
    \item \label{fence-lambda}
      $\labelingAct(\aEv) = \DF[\ascope]{\amode}[\aThrd]$,
      % \item%[{\labeltext[F3]{(F3)}{F3}}]
      %   $\labelingForm(\aEv) \rimplies \bigwedge_{\aLoc\in\aLocs}\Dx{\aLoc}$,
      \stepcounter{enumi}
    \item \label{fence-tau}
      $\aTr{\bEvs}{\bForm} \rimplies \bForm$,
    \item \label{fence-term}
      if $\aEvs=\emptyset$ then $\aTerm \rimplies \FALSE$.
    \end{enumerate}
  \end{multicols}

  \begin{align*}
    \begin{aligned}
      \sembase{\LET{\aReg}{\aExp}} &= \sLET{\aReg}{\aExp}
      \\
      \sembase{\PR[\amode]{\aLoc}{\aReg}} &= \sLOAD[\amode]{\aReg}[\ascope]{\aLoc}[\aThrd]
      \\
      \sembase{\PW[\amode]{\aLoc}{\aExp}} &= \sSTORE[\amode]{\aLoc}[\ascope]{\aExp}[\aThrd]
      \\
      \sembase{\PF[\ascope]{\fmode}} &= \sFENCE[\ascope]{\fmode}[\aThrd]
    \end{aligned}
    &&
    \begin{aligned}
      \sembase{\SKIP} &= \sSKIP 
      \\
      \sembase{\aCmd_1 \LPAR[\bThrd] \aCmd_2} &= \sLPAR{\sembase{\aCmd_1}}{\sembase{\aCmd_2}}
      \\
      \sembase{\aCmd_1 \SEMI \aCmd_2} &= \sSEMI{\sembase{\aCmd_1}}{\sembase{\aCmd_2}}
      \\
      \sembase{\IF{\aExp}\THEN\aCmd_1\ELSE\aCmd_2\FI} &= \sIFTHEN{\aExp{\neq}0}{\sembase{\aCmd_1}}{\sembase{\aCmd_2}}
    \end{aligned}
  \end{align*}
  \caption{Semantics of programs}
  \label{fig:sem}
\end{figure}
