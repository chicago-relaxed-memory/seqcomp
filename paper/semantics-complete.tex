\begin{scope}
  \renewcommand{\label}[1]{}
  \renewcommand{\makecounter}[1]{}
  \renewenvironment{definition}{\ignorespaces}{\ignorespacesafterend}
  \section{Complete Semantics for PwT-MCA1}

  Here we combine the features of \textsection\textsection\ref{sec:pomsets},
  \ref{sec:read-read}, \ref{sec:mca1}, \ref{sec:semreg}, \ref{sec:rmw},
  \ref{sec:semca}, and \ref{sec:false}.  Address calculation can be added by
  using the definition of $\sSTORE{}{}$ and $\sLOAD{}{}$ from
  \textsection\ref{sec:semcaaddr}.
  % \begin{gather*}
  %   \begin{aligned}
  %     \aCmd
  %     \BNFDEF& \LET{\aReg}{\aExp}
  %     \BNFSEP \PR[\amode]{\REF{\cExp}}[\ascope]{\aReg}
  %     \BNFSEP \PW[\amode]{\REF{\cExp}}[\ascope]{\aExp}
  %     \BNFSEP \PF[\ascope]{\fmode}
  %     \BNFSEP \SKIP
  %     \BNFSEP \aCmd_1 \SEMI \aCmd_2
  %     \BNFSEP \IF{\aExp} \THEN \aCmd_1 \ELSE \aCmd_2 \FI
  %     \BNFSEP \aCmd_1 \RPAR[\bThrd] \aCmd_2
  %     \\[-.5ex]
  %     \BNFSEP& \PCAS[\amode][\bmode]{\REF{\cExp}}[\ascope]{\aReg}{\aExp}{\bExp}
  %     \BNFSEP \PFADD[\amode][\bmode]{\REF{\cExp}}[\ascope]{\aReg}{\aExp}
  %     \BNFSEP \PEXCHG[\amode][\bmode]{\REF{\cExp}}[\ascope]{\aReg}{\aExp}
  %   \end{aligned}
  % \end{gather*}

  The semantics is built from the following.
  \begin{itemize}
  \item a set of \emph{events} $\AllEvents$, ranged over by $\aEv$, $\bEv$,
    $\cEv$, and subsets ranged over by $\aEvs$, $\bEvs$, $\cEvs$,
  %\item a set of \emph{phantom registers} $\uRegs{}$ and a map $\uReg{}:\AllEvents\fun\uRegs{}$ (notation $\uReg{\aEv}$),  
  \item a set of \emph{logical formulae} $\Formulae$, ranged over by $\aForm$,
    $\bForm$, $\cForm$,
  \item a set of \emph{actions} $\Act$, ranged over by $\aAct$, $\bAct$,
  \item a family of \emph{quiescence symbols} $\Q{\aLoc}$, indexed by location.
  \end{itemize}

  \noindent
  We require that
  \begin{itemize}
  \item registers include %\emph{phantom registers}
    $\uRegs{\AllEvents}=\{\uReg{\aEv}\mid\aEv\in\AllEvents\}$ which do not appear in commands:
    $\aCmd[\bExp/\uReg{\aEv}]=\aCmd$,
  %\item commands do not include phantom registers: $\aCmd[\bExp/\uReg{\aEv}]=\aCmd$,
  \item formulae include $\TRUE$, $\FALSE$, $\Q{\aLoc}$, and the equalities $(\aExp{=}\bExp)$ and $(\aLoc{=}\aExp)$,
  \item formulae are closed under $\lnot$, $\land$, $\lor$, $\limplies$, and
    substitutions $[\aExp/\aReg]$, $[\aExp/\aLoc]$, $[\aForm/\Q{\aLoc}]$,
  \item there is a relation $\rimpliesdef$ between
    formulae, capturing entailment, 
  \item $\rimpliesdef$ has the expected semantics for $=$, $\lnot$,
    $\land$, $\lor$, $\limplies$ and substitutions $[\aExp/\aReg]$,
    $[\aExp/\aLoc]$, $[\aForm/\Q{\aLoc}]$,
  \item there is a subset of $\Act$, distinguishing
    $\sreaddef$ actions,
  \item there are four binary relations over $\Act\times\Act$:
    $\rdelaysdef$ and ${\rmatchesdef}\subseteq{\rblocksdef}\subseteq{\roverlapsdef}$.
  \end{itemize}

  \noindent
  \begin{definition}  
    \label{def:labeling:consistent}
    Let $\aEvs\subseteq\AllEvents$ and $\labeling: \aEvs \fun \Act$.
    Define
    \begin{math}
      \regForm{\labeling}=
      \textstyle\bigwedge_{\{(\aEv,\aVal)\in(\aEvs\times\Val)\mid\labeling(\aEv)=\DRP{}{\aVal}\}}(\uReg{\aEv}\EQ\aVal)
      % \textwhere \aEvs=\fdom(\labeling)
    \end{math}.
    
    \noindent
    We say that $\aForm$ is \emph{$\labeling$-inconsistent} if $\aForm\land\regForm{\labeling}$ is unsatisfiable.
  \end{definition}
  
  \noindent
  \begin{definition}
    \label{def:trans}
    A \emph{$\labeling$-predicate transformer} is a function
    $\aTr{}{}:\Formulae\fun\Formulae$ such that
    \begin{enumerate}[,label=(\textsc{x}\arabic*),ref=\textsc{x}\arabic*]
    \item \label{tr-and}
      $\aTr{}{\bForm_1\land\bForm_2}\riff\aTr{}{\bForm_1}\land\aTr{}{\bForm_2}$,    
    \item \label{tr-or}
      $\aTr{}{\bForm_1\lor\bForm_2}\riff\aTr{}{\bForm_1}\lor\aTr{}{\bForm_2}$,
    \item \label{tr-implies}
      if $\aForm \rimplies \bForm$, then $\aTr{}{\aForm} \rimplies
      \aTr{}{\bForm}$,
    \item \label{tr-false}
      if $\bForm$ is $\labeling$-inconsistent then $\aTr{}{\bForm}$ is $\labeling$-inconsistent.
    \end{enumerate}
  \end{definition}
  \medskip

  \noindent
  \begin{definition}
    \label{def:family}
    A \emph{family of $\labeling$-predicate transformers} consists
    of a $\labeling$-predicate transformer $\aTr{\bEvs}{}$ for each
    $\bEvs\subseteq\AllEvents$, such that if $\cEvs \cap \aEvs \subseteq \bEvs$
    then $\aTr{\cEvs}{\bForm} \rimplies \aTr{\bEvs}{\bForm}$.
  \end{definition}
  \medskip

  \noindent
  A \emph{pomset with predicate transformers} (\PwT) is a tuple $(\aEvs, \labeling, \labelingForm, \aTr{}{}, \aTerm, {\lt}, {\rrfx}, {\rrmw})$ where
  \begin{enumerate}[,label=(\textsc{m}\arabic*),ref=\textsc{m}\arabic*]
    \makecounter{BE}
  \item \label{pom-E} \makecounter{E}
    $\aEvs\subseteq\AllEvents$ is a set of \emph{events},
    \makecounter{Blambda}
  \item \label{pom-lambda} \makecounter{lambda}
    $\labeling: \aEvs \fun \Act$ defines an \emph{action} for each event,
    \makecounter{Bkappa}
  \item \label{pom-kappa} \makecounter{kappa}
    $\labelingForm:\AllEvents\fun\Formulae$ defines a \emph{precondition} for each event,
    such that
    \begin{enumerate}
    \item \label{pom-kappa-sat}
      $\aEv\notin\aEvs$ implies $\labelingForm(\aEv)=\FALSE$,
    \end{enumerate}
    \makecounter{Btau}
  \item \label{pom-tau} \makecounter{tau}
    $\aTr{}{}:2^{\AllEvents}\fun\Formulae \fun\Formulae$ is a \emph{family of $\labeling$-predicate transformers} over $\aEvs$, 
    \makecounter{Bterm}
  \item \label{pom-term} \makecounter{term}
    $\aTerm:\Formulae$ is a \emph{termination condition}, such that 
    \begin{enumerate}
    \item \label{pom-term-tau}
      $\aTerm\rimplies\aTrAbbrv{\aEvs}{\TRUE}$,
    \end{enumerate}
    \makecounter{Ble}
  \item \label{pom-le} \makecounter{le}
    ${\lt} \subseteq \aEvs\times\aEvs$, is a strict partial order capturing
    \emph{causality}.
    \makecounter{Brf}
  \item \label{pom-rf} \makecounter{rf}
    ${\rrfx} \subseteq \aEvs\times\aEvs$ is an injective relation capturing \emph{reads-from}, such that 
    \begin{enumerate}
    \item \label{pom-rf-match} if $\bEv\xrfx\aEv$ then
      $\labeling(\bEv) \rmatches \labeling(\aEv)$,
    \item \label{pom-rf-block} if $\bEv\xrfx\aEv$ and
      $\labeling(\cEv) \rblocks \labeling(\aEv)$ then either $\cEv\le\bEv$ or
      $\aEv\le\cEv$,
    \item \label{pom-rf-le} if $\bEv\xrfx\aEv$ then $\bEv\lt\aEv$,
    \end{enumerate}
    \stepcounter{enumi}
    \stepcounter{enumi}
  \item \label{pom-rmw} \makecounter{rmw}
    ${\rrmw} : \aEvs\fun\aEvs$ is a partial function capturing read-modify-write \emph{atomicity}, such that
    \begin{enumerate}
    \item \label{pom-rmw-block} \label{pom-rmw-le}
      if $\bEv\xrmw\aEv$ then $\labeling(\aEv) \rblocks \labeling(\bEv)$, and $\bEv \lt \aEv$,
    % \item \label{pom-rmw-le}
    %   if $\bEv\xrmw\aEv$ then $\bEv \lt \aEv$, 
    \item \label{pom-rmw-atomic}
      if $\bEv \xrmw \aEv$ and $\labeling(\cEv)\roverlaps\labeling(\bEv)$ then
      $\cEv\lt \aEv$ implies $\cEv\le \bEv$ and
      $\bEv\lt \cEv$ implies $\aEv\le \cEv$.
    \end{enumerate}  
  \end{enumerate}
  \medskip

  \noindent
  \begin{minipage}{\linewidth}\noindent
  A \PwT{} is \emph{complete} if
  \begin{multicols}{2}
    \begin{enumerate}[,label=(\textsc{c}\arabic*),ref=\textsc{c}\arabic*]
      \setcounter{enumi}{\value{Bkappa}}
    \item \label{top-kappa}
      $\labelingForm(\aEv)$ is a tautology (for every $\aEv\in\aEvs$),
      \setcounter{enumi}{\value{Bterm}}
    \item \label{top-term}
      $\aTerm$ is a tautology,
      \setcounter{enumi}{\value{Brf}}
    \item \label{top-rf}
      if $\labeling(\aEv)$ is a $\sread$ then there is some $\bEv\xrfx\aEv$.
    \end{enumerate}
  \end{multicols}
  \end{minipage}
  \medskip

  \newpage
  \noindent
  If $\aPS\in\sSKIP$ then $\aEvs = \emptyset$
  and $\aTr{\bEvs}{\bForm} \riff \bForm$
  and $\aTerm\riff\TRUE$.
  \medskip

  \noindent
  If $\aPS\in\sLET{\aReg}{\aExp}$ then $\aEvs = \emptyset$
  and $\aTr{\bEvs}{\bForm} \riff \bForm[\aExp/\aReg]$
  and $\aTerm\riff\TRUE$.
  \medskip

  \noindent  
  Suppose $\aRel_i$ is a relation in $\aEvs_i\times\aEvs_i$.
  We say $\aRel \rextendsdef{\aRel_i}{}$ if
  $\aRel\cap(\aEvs_i\times \aEvs_i) = \aRel_i$.
  \medskip

  \noindent
  If $\aPS \in \sPAR{\aPSS_1}{\aPSS_2}$ then  
  $(\exists\aPS_1\in\aPSS_1)$ $(\exists\aPS_2\in\aPSS_2)$
  \begin{multicols}{2}
    \begin{enumerate}[topsep=0pt,label=(\textsc{p}\arabic*),ref=\textsc{p}\arabic*]
    \item \label{par-E}
      $\aEvs = (\aEvs_1\uplus\aEvs_2)$,
    \item \label{par-lambda}
      ${\labeling}=\PBR{{\labeling_1}\cup {\labeling_2}}$, 
    \item \label{par-kappa}
      $\labelingForm(\aEv) \riff \labelingForm_1(\aEv)\lor \labelingForm_2(\aEv)$,
    \item \label{par-tau}
      $\aTr{\bEvs}{\bForm} \riff \aTr[2]{\bEvs}{\bForm}$,
    \item \label{par-term}
      $\aTerm \riff \aTerm[1]\land\aTerm[2]$,
    \item \label{par-le}
      ${\lt}\rextends{\lt_1}{\lt_2}$,
    \item \label{par-rf}
      ${\rrfx}\rextends{\rrfx_1}{\rrfx_2}$,
      \setcounter{enumi}{\value{Brmw}}
    \item \label{par-rmw}
      ${\rrmw}=\PBR{{\rrmw_1}\cup{\rrmw_2}}$.
    \end{enumerate}
  \end{multicols}
  \medskip

  \noindent
  If $\aPS \in \sIF{\aForm}\sTHEN\aPSS_1\sELSE\aPSS_2\sFI$ then
  $(\exists\aPS_1\in\aPSS_1)$ $(\exists\aPS_2\in\aPSS_2)$
  \begin{multicols}{2}
    \begin{enumerate}[topsep=0pt,label=(\textsc{i}\arabic*),ref=\textsc{i}\arabic*]
    \item \label{if-E}
      $\aEvs = (\aEvs_1\cup\aEvs_2)$,
    \item \label{if-lambda}
      \labeltextXX{6}{i}{if-le}\,
      \labeltextXX{7}{i}{if-rf}\,
      \labeltextXX{10}{i}{if-rmw}\, as for $\sPAR{}{}$,
    % \item \label{if-lambda}
    %   ${\labeling}=\PBR{{\labeling_1}\cup {\labeling_2}}$,       
    \item \label{if-kappa}
      $\labelingForm(\aEv) \riff (\aForm\land\labelingForm_1(\aEv))\lor(\neg\aForm\land\labelingForm_2(\aEv))$,
    \item \label{if-tau}
      $\aTr{\bEvs}{\bForm} \riff (\aForm\land\aTr[1]{\bEvs}{\bForm})\lor(\neg\aForm\land\aTr[2]{\bEvs}{\bForm})$,
    \item \label{if-term}
      $\aTerm \riff (\aForm\land\aTerm[1])\lor(\neg\aForm\land\aTerm[2])$,
    % \item \label{if-le}
    %   ${\lt}\rextends{\lt_1}{\lt_2}$,
    % \item \label{if-rf}
    %   ${\rrfx}\rextends{\rrfx_1}{\rrfx_2}$,
    %   \setcounter{enumi}{\value{Brmw}}
    % \item \label{par-rmw}
    %   ${\rrmw}=\PBR{{\rrmw_1}\cup{\rrmw_2}}$.
    \end{enumerate}
  \end{multicols}
  \medskip

  \noindent
  If $\aPS \in \sSEMI{\aPSS_1}{\aPSS_2}$ then $(\exists\aPS_1\in\aPSS_1)$ $(\exists\aPS_2\in\aPSS_2)$
  % \\let
  % $\labelingForm'_2(\aEv)=\aTr[1]{\Cdown{\aEv}}{\labelingForm_2(\aEv})$ where
  % $\Cdown{\aEv}=\{ \cEv \mid \cEv \lt \aEv \}$
  \begin{multicols}{2}
    \begin{enumerate}[topsep=0pt,label=(\textsc{s}\arabic*),ref=\textsc{s}\arabic*]
    \item \label{seq-E} %\label{seq-lambda}
      \labeltextXX{2}{s}{seq-lambda}\,
      \labeltextXX{6}{s}{seq-le}\,
      \labeltextXX{7}{s}{seq-rf}\,
      \labeltextXX{10}{s}{seq-rmw}\, as for $\sIFTHEN{}{}{}$, %$\sPAR{}{}$,
      \setcounter{enumi}{\value{Bkappa}}
    % \item \label{seq-E}
    %   $\aEvs = (\aEvs_1\cup\aEvs_2)$,
    % \item \label{seq-lambda}
    %   ${\labeling}=\PBR{{\labeling_1}\cup {\labeling_2}}$, 
    \item \label{seq-kappa}
      $\labelingForm(\aEv) \riff {\labelingForm_1(\aEv)\lor\labelingForm'_2(\aEv)}$,
    \item \label{seq-tau}
      $\aTr{\bEvs}{\bForm} \riff \aTr[1]{\bEvs}{\aTr[2]{\bEvs}{\bForm}}$,
    \item \label{seq-term}
      $\aTerm \riff \aTerm[1]\land\aTrAbbrv[1]{\aEvs_1}{\aTerm[2]}$,
    % \item \label{seq-le}
    %   ${\lt}\rextends{\lt_1}{\lt_2}$,
    \item[] \setcounter{enumi}{\value{le}}
      \begin{enumerate}[leftmargin=0pt]
      \item \label{seq-le-delays}
        if $\labeling_1(\bEv) \rdelays \labeling_2(\aEv)$ then $\bEv\le\aEv$,
      \end{enumerate}
    % \item \label{seq-rf}
    %   ${\rrfx}\rextends{\rrfx_1}{\rrfx_2}$,    
    %   \setcounter{enumi}{\value{Brmw}}
    % \item \label{seq-rmw}
    %   ${\rrmw}=\PBR{{\rrmw_1}\cup{\rrmw_2}}$.
    \end{enumerate}
  \end{multicols}
  %\vspace{-.7\baselineskip}
  where
  \begin{displaymath}
    \labelingForm'_2(\aEv)=
    \begin{cases}
      \aTrAbbrv[1]{\aEvs_1}{\labelingForm_2(\aEv)} & \text{if}\; \labeling(\aEv) \;\text{is a}\sread
      \\
      \aTr[1]{\Cdown{\aEv}}{\labelingForm_2(\aEv)} & \text{otherwise, where}\; \Cdown{\aEv}=\{ \cEv \mid \cEv \lt \aEv \}
    \end{cases}
    % $\Cdown{\aEv}=\{ \cEv \mid \cEv \lt \aEv \}$ if $\labeling(\aEv)$ is a write, and $\Cdown{\aEv}=\aEvs_1$, otherwise
    % \Cdown{\aEv}=
    % \begin{cases}
    %   \{ \cEv \mid \cEv \lt \aEv \} & \textif \labeling(\aEv) \;\text{is a write}
    %   \\
    %   \aEvs_1 & \textotherwise
    % \end{cases}
  \end{displaymath}
  %\medskip

  \noindent
  Let 
  \begin{math}
    \kappaE{\bEvs}=
    {\textstyle\bigvee{}\!\!{}_{\bEv\in\bEvs}\labelingForm(\bEv)}.
  \end{math}
  Note that $\kappaE{\emptyset} = \FALSE$.
  \medskip

  \noindent
  Let $\FormulaeUReg=\{\aForm\in\Formulae\mid \forall\aEv\in\AllEvents.\;\forall\aVal\in\Val.\;\aForm\riff \aForm[\aVal/\uReg{\aEv}]\}$.
  \medskip

  \noindent
  If $\aPS \in \sFENCE[\ascope]{\amode}[\aThrd]$ then
  $(\exists\aForm:\aEvs\fun\FormulaeUReg)$
  \begin{multicols}{2}
    \begin{enumerate}[topsep=0pt,label=(\textsc{f}\arabic*),ref=\textsc{f}\arabic*]
    \item \label{fence-E}
      if $\aForm_\bEv\land\aForm_\aEv$ is satisfiable then $\bEv=\aEv$,
    \item \label{fence-lambda}
      $\labelingAct(\aEv) = \DF[\ascope]{\amode}[\aThrd]$,
    \item \label{fence-kappa}
      \begin{math}
        \labelingForm(\aEv) \riff
        \aForm_\aEv
      \end{math},    
    \item \label{fence-tau}
      $\aTr{\bEvs}{\bForm} \riff \bForm$,
    \item \label{fence-term}
      $\aTerm \riff \kappaE{}$.
    \end{enumerate}
  \end{multicols}
  \medskip

  \noindent
  If $\aPS \in \sSTORE[\amode]{\aLoc}[\ascope]{\aExp}[\aThrd]$ then
  $(\exists\aVal:\aEvs\fun\Val)$
  $(\exists\aForm:\aEvs\fun\FormulaeUReg)$
  \begin{multicols}{2}
    \begin{enumerate}[topsep=0pt,label=(\textsc{w}\arabic*),ref=\textsc{w}\arabic*]
    \item \label{write-E-ca}
      if $\aForm_\bEv\land\aForm_\aEv$ is satisfiable then $\bEv=\aEv$,
    \item \label{write-lambda-ca}
      $\labelingAct(\aEv) = \DW[\amode]{\aLoc}[\ascope]{\aVal_\aEv}[\aThrd]$,
    \item \label{write-kappa-ca}
      \begin{math}
        \labelingForm(\aEv) \riff
        \aForm_\aEv
        \land
        \aExp{=}\aVal_\aEv
      \end{math},    
    \item \label{write-tau-ca}
      \begin{math}
        \aTr{\bEvs}{\bForm} \riff
        \bForm
        [\aExp/\aLoc][{\kappaE{}}/\Q{\aLoc}], 
      \end{math}
    \item \label{write-term-ca}
      $\aTerm \riff \kappaE{}$.
    \end{enumerate}  
  \end{multicols}
  \medskip

  \noindent
  If $\aPS \in \sLOAD[\amode]{\aReg}[\ascope]{\aLoc}[\aThrd]$ then
  $(\exists\aVal:\aEvs\fun\Val)$
  $(\exists\aForm:\aEvs\fun\FormulaeUReg)$
  \begin{multicols}{2}
    \begin{enumerate}[topsep=0pt,label=(\textsc{r}\arabic*),ref=\textsc{r}\arabic*]
    \item \label{read-E-ca}
      if $\aForm_\bEv\land\aForm_\aEv$ is satisfiable then $\bEv=\aEv$,
    \item \label{read-lambda-ca}
      $\labelingAct(\aEv) = \DR[\amode]{\aLoc}[\ascope]{\aVal_\aEv}[\aThrd]$
    \item \label{read-kappa-ca}
      \begin{math}
        \labelingForm(\aEv) \riff
        \aForm_\aEv
        \land
        \Q{\aLoc}
      \end{math},
    \item \label{read-tau-ca}
      \begin{math}
        \begin{aligned}[t]
          \aTr{\bEvs}{\bForm} \riff
          &\textstyle\bigwedge_{\aEv\in\aEvs\cap\bEvs}
          \aForm_\aEv\limplies
          {
            \PBR{
              \labelingForm(\aEv)
              \limplies \aVal_\aEv{=}\uReg{\aEv}
            }
            \limplies
            \bForm[\uReg{\aEv}/\aReg]
          }
          \\[-.5ex]
          \land
          &\textstyle\bigwedge_{\aEv\in\aEvs\setminus\bEvs}
          \aForm_\aEv\limplies
          {
            \PBR{
              \labelingForm(\aEv)
              \limplies
              \PBR{\aVal_\aEv{=}\uReg{\aEv} \lor \aLoc{=}\uReg{\aEv}}
            }
            \limplies
            \bForm[\uReg{\aEv}/\aReg]
          }
          \\[-.5ex]
          \land
          &
          \textstyle (\bigwedge_{\aEv\in\aEvs}\lnot\aForm_\aEv)
          \limplies 
          (\forall\bReg)\;
          \bForm[\bReg/\aReg]
        \end{aligned}
      \end{math}

      \columnbreak
      \stepcounter{enumi}
    \item[] \labeltext[\textsc{r}5]{}{read-term-ca}
      \begin{enumerate}[leftmargin=0pt]
      \item \label{read-term-nonempty-ca}
        if $\amode\lemode\mRLX$ then $\aTerm \riff \TRUE$,
      \item \label{read-term-empty-ca}
        if $\amode\gemode\mACQ$ then
        \begin{math}
          \aTerm \riff
          \kappaE{}.
        \end{math}
      \end{enumerate}      
    \end{enumerate}
  \end{multicols}
  \medskip


  \noindent
  If $\aPS \in \sLOADP[\amode]{\aReg}[\ascope]{\aLoc}[\aThrd]$ then
  $(\exists\aVal:\aEvs\fun\Val)$
  $(\exists\aForm:\aEvs\fun\FormulaeUReg)$ as for $\sLOAD{}{}$ except
  \begin{multicols}{2}
    \begin{enumerate}[topsep=0pt,label=(\textsc{r}\arabic*$'$),ref=\textsc{r}\arabic*$'$]
      \setcounter{enumi}{\value{Btau}}
    \item \label{readp-tau-ca}
      \begin{math}
        \begin{aligned}[t]
          \aTr{\bEvs}{\bForm} \riff
          &\textstyle\bigwedge_{\aEv\in\aEvs\cap\bEvs}
          \aForm_\aEv\limplies
          {
            \PBR{
              \labelingForm(\aEv)
              \limplies \aVal_\aEv{=}\uReg{\aEv}
            }
            \limplies
            \bForm[\uReg{\aEv}/\aReg]
          }
          \\[-.5ex]
          \land
          &\textstyle\bigwedge_{\aEv\in\aEvs\setminus\bEvs}
          \aForm_\aEv\limplies
          (\forall\bReg)\;
          \bForm[\bReg/\aReg]
          \\[-.5ex]
          \land
          &
          \textstyle (\bigwedge_{\aEv\in\aEvs}\lnot\aForm_\aEv)
          \limplies 
          (\forall\bReg)\;
          \bForm[\bReg/\aReg]
        \end{aligned}
      \end{math}
    \end{enumerate}
  \end{multicols}
  \medskip


  \noindent
  If $\aPS\in\sCAS[\amode][\bmode]{\aLoc}[\ascope]{\aReg}{\aExp}{\bExp}[\aThrd]$ then
  \begin{math}
    \PBR{\exists
      \aPS\in\sSEMI{
        \sLOADP[\amode]{\aReg}[\ascope]{\aLoc}[\aThrd]
      }{
        \sIF{\aReg{=}\aExp}\sTHEN\sSTORE[\bmode]{\aLoc}[\ascope]{\bExp}[\aThrd]\sELSE\sSKIP\sFI
      }
    }
  \end{math}
  \begin{enumerate}[label=(\textsc{u}\arabic*),ref=\textsc{u}\arabic*]
    \setcounter{enumi}{\value{Brmw}}
  \item \label{cas-rmw} if $\labeling(\aEv)$ is a write then there is a read
    $\labeling(\bEv)$ such that
    $\labelingForm(\aEv)\rimplies\labelingForm(\bEv)$ and $\bEv\xrmw\aEv$.
  \end{enumerate}
  \medskip

  \noindent
  If $\aPS\in\sFADD[\amode][\bmode]{\aLoc}[\ascope]{\aReg}{\aExp}[\aThrd]$ then
  \begin{math}
    \PBR{\exists
      \aPS\in\sSEMI{
        \sLOADP[\amode]{\aReg}[\ascope]{\aLoc}[\aThrd]
      }{
        \sSTORE[\bmode]{\aLoc}[\ascope]{\aReg{+}\aExp}[\aThrd]
      }
    }
  \end{math}
  \begin{enumerate}[label=(\textsc{u}\arabic*),ref=\textsc{u}\arabic*]
    \setcounter{enumi}{\value{Brmw}}
  \item \label{fadd-rmw} if $\labeling(\aEv)$ is a write then there is a read
    $\labeling(\bEv)$ such that
    $\labelingForm(\aEv)\rimplies\labelingForm(\bEv)$ and $\bEv\xrmw\aEv$.
  \end{enumerate}
  \medskip

  \noindent
  If $\aPS\in\sEXCHG[\amode][\bmode]{\aLoc}[\ascope]{\aReg}{\aExp}[\aThrd]$ then
  \begin{math}
    \PBR{\exists
      \aPS\in\sSEMI{
        \sLOADP[\amode]{\aReg}[\ascope]{\aLoc}[\aThrd]
      }{
        \sSTORE[\bmode]{\aLoc}[\ascope]{\aExp}[\aThrd]
      }
    }
  \end{math}
  \begin{enumerate}[label=(\textsc{u}\arabic*),ref=\textsc{u}\arabic*]
    \setcounter{enumi}{\value{Brmw}}
  \item \label{exch-rmw} if $\labeling(\aEv)$ is a write then there is a read
    $\labeling(\bEv)$ such that
    $\labelingForm(\aEv)\rimplies\labelingForm(\bEv)$ and $\bEv\xrmw\aEv$.
  \end{enumerate}

  \begin{gather*}
    \begin{aligned}
      \sembase{\LET{\aReg}{\aExp}} &= \sLET{\aReg}{\aExp}
      \\
      \sembase{\PW[\amode]{\aLoc}{\aExp}} &= \sSTORE[\amode]{\aLoc}[\ascope]{\aExp}[\aThrd]
      \\
      \sembase{\PR[\amode]{\aLoc}{\aReg}} &= \sLOAD[\amode]{\aReg}[\ascope]{\aLoc}[\aThrd]
    \end{aligned}
    \qquad
    \begin{aligned}
      \sembase{\PF[\ascope]{\fmode}} &= \sFENCE[\ascope]{\fmode}[\aThrd]
      \\
      \sembase{\SKIP} &= \sSKIP 
      \\
      \;\;
    \end{aligned}
    \qquad
    \begin{aligned}
      \sembase{\aCmd_1 \RPAR \aCmd_2} &= \sPAR{\sembase{\aCmd_1}}{\sembase{\aCmd_2}}
      \\
      \sembase{\aCmd_1 \SEMI \aCmd_2} &= \sSEMI{\sembase{\aCmd_1}}{\sembase{\aCmd_2}}
      \\
      \makebox[0cm][r]{$\sembase{\IF{\aExp}\THEN\aCmd_1\ELSE\aCmd_2\FI}$} &= \sIFTHEN{\aExp{\neq}0}{\sembase{\aCmd_1}}{\sembase{\aCmd_2}}
    \end{aligned}
  \end{gather*}
  \begin{align*}
    \sem[\aThrd]{\PCAS[\amode][\bmode]{\aLoc}[\ascope]{\aReg}{\aExp}{\bExp}}
    &=
      \sCAS[\amode][\bmode]{\aLoc}[\ascope]{\aReg}{\aExp}{\bExp}[\aThrd]
    \\
    \sem[\aThrd]{\PFADD[\amode][\bmode]{\aLoc}[\ascope]{\aReg}{\aExp}}
    &=
      \sFADD[\amode][\bmode]{\aLoc}[\ascope]{\aReg}{\aExp}[\aThrd]
    \\
    \sem[\aThrd]{\PEXCHG[\amode][\bmode]{\aLoc}[\ascope]{\aReg}{\aExp}}
    &=
      \sEXCHG[\amode][\bmode]{\aLoc}[\ascope]{\aReg}{\aExp}[\aThrd]
  \end{align*}
\end{scope}



%%%%%%%%%%%%%%%%%%%%%% 

% \noindent
% If $\aPS \in \sSTORE[\amode]{\aLoc}[\ascope]{\aExp}[\aThrd]$ then
% $(\exists\aVal\in\Val)$
% \begin{multicols}{2}
%   \begin{enumerate}[topsep=0pt,label=(\textsc{w}\arabic*),ref=\textsc{w}\arabic*]
%   \item \label{write-E}
%     $\fcard{\aEvs}\leq1$,
%     %     if $\bEv,\aEv\in\aEvs$ then $\bEv=\aEv$,
%   \item \label{write-lambda}
%     $\labelingAct(\aEv) = \DW[\amode]{\aLoc}[\ascope]{\aVal}[\aThrd]$,
%   \item \label{write-kappa}
%     \begin{math}
%       \labelingForm(\aEv) \riff
%       \aExp{=}\aVal
%     \end{math},    
%   \item \label{write-tau}
%     \begin{math}
%       \aTr{\bEvs}{\bForm} \riff 
%       \bForm
%       [\aExp/\aLoc][\kappaE{}/\Q{\aLoc}],
%     \end{math}
%   \item \label{write-term}
%     $\aTerm \riff \kappaE{}$,
%   \end{enumerate}
% \end{multicols}
% \medskip

% \noindent
% If $\aPS \in \sLOAD[\amode]{\aReg}[\ascope]{\aLoc}[\aThrd]$ then
% $(\exists\aVal\in\Val)$
% \begin{multicols}{2}
%   \begin{enumerate}[topsep=0pt,label=(\textsc{r}\arabic*),ref=\textsc{r}\arabic*]
%   \item \label{read-E}
%     $\fcard{\aEvs}\leq1$,
%   \item \label{read-lambda}
%     $\labelingAct(\aEv) = \DR[\amode]{\aLoc}[\ascope]{\aVal}[\aThrd]$,
%   \item \label{read-kappa}
%     $\labelingForm(\aEv) \riff \Q{\aLoc}$,
%     \stepcounter{enumi}
%   \item[] \labeltext[\textsc{r}4]{}{read-tau}
%     \begin{enumerate}[leftmargin=0pt]
%     \item \label{read-tau-dep}
%       if $\aEv\in\aEvs\cap\bEvs$ then
%       \makebox[0pt][l]{%
%       \begin{math}
%         \aTr{\bEvs}{\bForm} \riff
%         (\labelingForm(\aEv)\limplies\aVal{=}\aReg)
%         \limplies \bForm,
%       \end{math}
%     }
%     \item \label{read-tau-ind}
%       if $\aEv\in\aEvs\setminus\bEvs$ then
%       \makebox[0pt][l]{\begin{math}
%         \aTr{\bEvs}{\bForm} \riff
%         \PBR{
%         \labelingForm(\aEv)
%         \limplies
%         \PBR{
%         \aVal{=}\aReg \lor \aLoc{=}\aReg
%       }
%       }
%         \limplies \bForm,
%       \end{math}}
%       \columnbreak
%     \item \label{read-tau-empty}
%       if $\aEvs=\emptyset$ then
%       \begin{math}
%         \aTr{\bEvs}{\bForm} \riff
%         \bForm,
%       \end{math}
%     \end{enumerate}
%     \stepcounter{enumi}
%   \item[] \labeltext[\textsc{r}5]{}{read-term}
%     \begin{enumerate}[leftmargin=0pt]
%     \item \label{read-term-nonempty}
%       if $\amode\lemode\mRLX$ then $\aTerm \riff \TRUE$,
%     \item \label{read-term-empty}
%       if $\amode\gemode\mACQ$ then
%       \begin{math}
%         \aTerm \riff
%         \kappaE{}.
%       \end{math}
%     \end{enumerate}      
%   \end{enumerate}
% \end{multicols}
% \medskip
