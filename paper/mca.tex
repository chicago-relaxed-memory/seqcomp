\section{\PwTmcaTITLE{}: Pomsets with Predicate Transformers for MCA}
\label{sec:mca}
We define two models for \mca{} architectures: \PwTmca{1} and \PwTmca{2}.
We drop the subscript when referring to both models.

\subsection{First Semantics}
\label{sec:mca1}

\begin{definition}
  \label{def:pwt:mca1}
  A \PwTmca{1} is a \PwT{} (\refdef{def:pomset}) equipped
  with a relation $\rrfx$ such that 
  \begin{enumerate}[,label=(\textsc{m}\arabic*),ref=\textsc{m}\arabic*]
    \setcounter{enumi}{\value{Brf}}
  \item \label{pom-rf} \makecounter{rf} ${\rrfx} \subseteq \aEvs\times\aEvs$
    is an injective relation capturing \emph{reads-from}, such that
    % \end{enumerate}
    % A pomset is a \emph{candidate} if there is an injective relation
    % ${\rrfx} : \aEvs\times\aEvs$, capturing \emph{reads-from}, such that
    \begin{enumerate}
      % \begin{enumerate}[,label=(\textsc{i}\arabic*),ref=\textsc{i}\arabic*]
      % \item \label{rf-injective}
      %   if $\bEv\xrfx\aEv$ and $\cEv\xrfx\aEv$ then $\bEv=\cEv$, that is,
      %   ${\rrfx}$ is injective,
    \item \label{pom-rf-match} if $\bEv\xrfx\aEv$ then
      $\labeling(\bEv) \rmatches \labeling(\aEv)$,
    \item \label{pom-rf-block} if $\bEv\xrfx\aEv$ and
      $\labeling(\cEv) \rblocks \labeling(\aEv)$ then either $\cEv\le\bEv$ or
      $\aEv\le\cEv$,
    \item \label{pom-rf-le} if $\bEv\xrfx\aEv$ then $\bEv\le\aEv$.
    \end{enumerate}
  \end{enumerate}

  A \PwTmca{} is \emph{complete} if %it is a complete \PwT{} (\refdef{def:pomset}) and
  \begin{multicols}{2}
    \begin{enumerate}[,label=(\textsc{c}\arabic*),ref=\textsc{c}\arabic*]
    \item[\eqref{top-kappa}]
      \eqref{top-term}\;
      as in \refdef{def:pomset},
      \setcounter{enumi}{\value{Brf}}
    \item \label{top-rf}
      if $\labeling(\aEv)$ is a $\sread$ then there is some $\bEv\xrfx\aEv$.
    \end{enumerate}
  \end{multicols}
\end{definition}

% To include \RMW{}s, also add
% \begin{enumerate}
% \item[(\textsc{p}10)]\;
%   ${\rrmw}=\PBR{{\rrmw_1}\cup{\rrmw_2}}$,
% \end{enumerate}

\input{fig-mca1.tex}
\input{fig-mca2.tex}

The semantic rules are given in \reffig{fig:mca1}.  Let
\begin{math}
  \sembase{\aCmd_1 \LPAR[\bThrd] \aCmd_2} = \sLPAR{\sembase{\aCmd_1}}{\sembase{\aCmd_2}}.
\end{math}

From the data model, we require an additional binary relation 
${\rdelays}\subseteq(\Act\times\Act)$.  For the actions in this paper, we
define this as follows.

\begin{scope}
  Let ${\eqreorderco}$ capture write-write, read-write coherence:
  \begin{math}
    {\eqreorderco}
    =
    \{(\DW{\aLoc}{}\Cb \DW{\aLoc}{})\Cc(\DR{\aLoc}{}\Cb \DW{\aLoc}{})\Cc(\DW{\aLoc}{}\Cb \DR{\aLoc}{})\}
  \end{math}.

  Let ${\reorderra}$ capture conflict due to synchronization:
  \begin{math}
    {\reorderra}
    =
    \{(\aAct\Cb             \DW[\gemode\mREL]{}{}     )\Cc
    (\aAct\Cb               \DF{\gemode\fREL}        )\Cc
    (\DR{}{}\Cb             \DF{\gemode\fACQ}        )\Cc
    % (\DR{\aLoc}{}\Cb        \DR[\gemode\mACQ]{\aLoc}{})\Cc
    (\DR[\gemode\mACQ]{}{}\Cb\aAct                    )\Cc
    (\DF{\gemode\fACQ}\Cb   \aAct                    )\Cc
    (\DF{\gemode\fREL}\Cb   \DW{}{}                  )\Cc
    (\DW[\gemode\mREL]{\aLoc}{}\Cb\DW{\aLoc}{})\}
  \end{math}.

  Let ${\eqreordersc}$ capture conflict due to $\mSC$ access:
  \begin{math}
    {\eqreordersc}
    =
    % \{(\DX[\mSC]{}{}\Cb\DX[\mSC]{}{})\}
    \{(\DW[\mSC]{}{}\Cb \DW[\mSC]{}{})\Cc(\DR[\mSC]{}{}\Cb \DW[\mSC]{}{}) \Cc(\DW[\mSC]{}{}\Cb \DR[\mSC]{}{})\Cc(\DR[\mSC]{}{}\Cb \DR[\mSC]{}{})\}
  \end{math}.

  We say $\aAct \rdelaysdef \bAct$ if $\aAct\eqreorderco\bAct$ or $\aAct\reorderra\bAct$ or $\aAct\eqreordersc\bAct$.
\end{scope}

\subsection{Second Semantics}
\label{sec:mca2}

In the second semantics, we weaken the relationship between $\rrfx$
and $\le$ in \ref{pom-rf-le}.  Rather than ensuring that there is no
\emph{global} blocker for a sequentially fulfilled read \eqref{pom-rf-le}, we
require only that there is no \emph{thread-local} blocker
\eqref{seq-rf-le-rf}.
% This change both allows and requires us to weaken the definition of
% \emph{delays} to drop write-to-read order from $\eqreorderco$.

With the weakening of \ref{seq-rf-le-rf}, we must be careful not to allow
spurious pairs to be added to the $\rrfx$ relation.  Thus we add
\ref{par-rf-extends},
\ref{seq-rf-extends}, and
\ref{if-rf-extends}.
For example, \ref{if-rf-extends} ensure that
\begin{math}
  \frf{\semrr{\IF{b}\THEN\PR{x}{r}\PAR\PW{x}{1}\ELSE\PR{x}{r}\SEMI\PW{x}{1}\FI}}
\end{math}
does not include 
\begin{math}
  \smash{\hbox{\begin{tikzinlinesmall}[node distance=1.5em]
        \event{a}{\DR{x}{1}}{}
        \event{b}{\DW{x}{1}}{right=of a}
        \rfint[out=165,in=15]{b}{a}
        \wki{a}{b}
      \end{tikzinlinesmall}}}
\end{math}, taking $\rrfx$ from the left and $\le$ from the right.

\begin{definition}
  \label{def:pwt:mca2}
  A \PwTmca{2} is a \PwT{} (\refdef{def:pomset}) equipped
  with a relation $\rrfx$ such that 
  \begin{enumerate}[,label=(\textsc{m}\arabic*),ref=\textsc{m}\arabic*]
    \setcounter{enumi}{\value{Brf}}
  \item \label{pom-rf'} ${\rrfx} \subseteq \aEvs\times\aEvs$
    is an injective relation capturing \emph{reads-from}, such that
    % \end{enumerate}
    % A pomset is a \emph{candidate} if there is an injective relation
    % ${\rrfx} : \aEvs\times\aEvs$, capturing \emph{reads-from}, such that
    \begin{multicols}{2}    
      \begin{enumerate}
        % \begin{enumerate}[,label=(\textsc{i}\arabic*),ref=\textsc{i}\arabic*]
        % \item \label{rf-injective}
        %   if $\bEv\xrfx\aEv$ and $\cEv\xrfx\aEv$ then $\bEv=\cEv$, that is,
        %   ${\rrfx}$ is injective,
      \item[\eqref{pom-rf-match}]
        \eqref{pom-rf-block}\;
        as in \refdef{def:pwt:mca1},
        \setcounter{enumii}{2}
      \item \label{pom-rf-le'} 
        if $\bEv\xrfx\aEv$ then either $\bEv\le\aEv$ or $\aEv\le\bEv$.
      \end{enumerate}
    \end{multicols}
  \end{enumerate}
\end{definition}
% Derive $\rdelayspdef$ from $\rdelaysdef$ by replacing $\eqreorderco$ with
% \begin{math}
%   {\reorderlws}
%   =
%   \{(\DW{\aLoc}{}, \DW{\aLoc}{}),\;(\DR{\aLoc}{}, \DW{\aLoc}{})\}.
% \end{math}
% The acronym $\textsf{lws}$ is adopted from \armeight.  It stands for
% \emph{Local Write Successor}.

The semantic rules are given in \reffig{fig:mca2}.

