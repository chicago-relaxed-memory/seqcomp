% This paper presents the first compositional definition of sequential
% composition that applies to a relaxed memory model weak enough to allow
% efficient implementation on Arm.  We extend the denotational model of pomsets
% with preconditions with predicate transformers. Previous work has shown that
% pomsets with preconditions are a model of concurrent composition, and that
% predicate transformers are a model of sequential composition.  This paper
% show how they can be combined.

% Program logics and semantics tell us that in order to derive
% \begin{math}
%   ((S_1\SEMI S_2), \sigma_0) \Downarrow \sigma_2,
% \end{math}
% we derive 
% \begin{math}
%   (S_1, \sigma_0) \Downarrow \sigma_1
% \end{math}
% and then
% \begin{math}
%   (S_2, \sigma_1) \Downarrow \sigma_2.
% \end{math}
Program logics and semantics tell a pleasant story about sequential
composition: when executing $(S_1; S_2)$, we first execute $S_1$ then $S_2$.
To improve performance, however, processors execute instructions out of
order, and compilers reorder programs even more dramatically.  By design,
single-threaded systems cannot observe these reorderings; however,
multiple-threaded systems can, making the story considerably less pleasant.
A formal attempt to understand the resulting mess is known as a ``relaxed
memory model.''  Prior models either fail to address sequential composition
directly, or overly restrict processors and compilers, or permit nonsense
thin-air behaviors which are unobservable in practice.

To support sequential composition while targeting modern hardware, we enrich
the standard event-based approach with \emph{preconditions} and
\emph{families of predicate transformers}.
%
% When calculating the precondition of an event $e$ in $\sem{S_1;S_2}$, from
% $\sem{S_2}$ is derived by applying a predicate transformer chosen based on
% events of $\sem{S_1}$ upon which $e$ depends.
When calculating $\sem{S_1;S_2}$, the predicate transformer applied to the
precondition of an event $e$ from $\sem{S_2}$ is chosen based on the set of
events in $\sem{S_1}$ upon which $e$ depends.  We apply this approach to two
existing memory models.
% : ``Modular Relaxed Dependencies'' for C11 and
% ``Pomsets with Preconditions.''


\endinput
