\begin{figure}
  \bookmark{PwT Semantics}
  \raggedright
  
  \noindent
  Suppose $\aRel_i$ is a relation in $\aEvs_i\times\aEvs_i$.
  We say $\aRel \rextendsdef{\aRel_i}{}$ if
  ${\aRel}\supseteq {\aRel_i}$ and
  $\aRel\cap(\aEvs_i\times \aEvs_i) = \aRel_i$.
  \medskip

  \noindent
  % Within a pomset $\aPS$,
  Let 
  \begin{math}
    \kappaE{\bEvs}=
    {\textstyle\bigvee{}\!\!{}_{\bEv\in\bEvs}\labelingForm(\bEv)}.
  \end{math}
  Note that $\kappaE{\emptyset} = \FALSE$.
  \medskip

  \noindent
  If $\aPS\in\sSKIP$ then $\aEvs = \emptyset$
  and $\aTr{\bEvs}{\bForm} \riff \bForm$
  and $\aTerm\riff\TRUE$.
  \medskip

  \noindent
  If $\aPS \in \sSEMI{\aPSS_1}{\aPSS_2}$ then $(\exists\aPS_1\in\aPSS_1)$ $(\exists\aPS_2\in\aPSS_2)$\\
  let
  %$\labelingForm'_2(\aEv)=\aTr[1]{}{\labelingForm_2(\aEv})$ if $\labeling(\aEv)$ is a $\sread$---otherwise
  $\labelingForm'_2(\aEv)=\aTr[1]{\Cdown{\aEv}}{\labelingForm_2(\aEv})$, where
  $\Cdown{\aEv}=\{ \cEv \mid \cEv \lt \aEv \}$,
  % RELEASE:
  % \\ and
  % $\aTerm[1](\aEv) = \aTerm[1]$ if $\labeling(\aEv)$ is a $\srelease$---otherwise
  % $\aTerm[1](\aEv) = \TRUE$.
  %
  % let $\aTerm[1](\aEv) = \aTerm[1]$ if $\labeling_2(\aEv)$ is a $\srelease$
  % and $\aTerm[1](\aEv) = \TRUE$ otherwise,\\
  % let $\labelingForm'_2(\aEv)=\aTr[1]{\Cdown{\aEv}}{\labelingForm_2(\aEv})$,
  % where
  % $\Cdown{\aEv}=\{ \cEv \mid \cEv \lt \aEv \}$%, if $\labeling(\aEv)$ is a write, and $\Cdown{\aEv}=\aEvs_1$, otherwise
  %
  % \begin{math}
  %   \Cdown{\aEv}=
  %   \begin{cases}
  %     \{ \cEv \mid \cEv \lt \aEv \} & \textif \labeling(\aEv) \;\text{is a write}
  %     \\
  %     \aEvs_1 & \textotherwise
  %   \end{cases}
  % \end{math}
  % let
  % \begin{math}
  %   \smash{
  %   \downarrow\aEv=\begin{cases}
  %     \{ \cEv \mid \cEv \lt \aEv \} &\textif \labeling(\aEv) \;\text{is a write}\\
  %     \aEvs_1 &\textotherwise
  %   \end{cases}}
  % \end{math}
  \begin{multicols}{2}
    \begin{enumerate}[topsep=0pt,label=(\textsc{s}\arabic*),ref=\textsc{s}\arabic*]
    \item \label{seq-E}
      $\aEvs = (\aEvs_1\cup\aEvs_2)$,
    \item \label{seq-lambda}
      ${\labeling}=\PBR{{\labeling_1}\cup {\labeling_2}}$, 
      \stepcounter{enumi}
    \item[] \labeltext[\textsc{s}3]{}{seq-kappa}
      \begin{enumerate}[leftmargin=0pt]
      \item \label{seq-kappa1}
        if $\aEv\in\aEvs_1\setminus\aEvs_2$ then $\labelingForm(\aEv) \riff \labelingForm_1(\aEv)$,
      \item \label{seq-kappa2}
        if $\aEv\in\aEvs_2\setminus\aEvs_1$ then $\labelingForm(\aEv) \riff \labelingForm'_2(\aEv)$, % \land \aTerm[1](\aEv)$,
      \item \label{seq-kappa12}
        % if $\aEv{\in}\aEvs_1{\cap}\aEvs_2$ then $\labelingForm(\aEv) \riff \labelingForm_1(\aEv){\lor}\labelingForm'_2(\aEv)$,\\
        \makebox[0pt][l]{%
          if $\aEv\in\aEvs_1\cap\aEvs_2$ then $\labelingForm(\aEv) \riff {\labelingForm_1(\aEv)\lor\labelingForm'_2(\aEv)}$,% \land \aTerm[1](\aEv)$,
        }
        % where
        % $\labelingForm'_2(\aEv)=\aTr[1]{\Cdown{\aEv}}{\labelingForm_2(\aEv})$,
        % where $\Cdown{\aEv}=\{ \cEv \mid \cEv \lt \aEv \}$ if $\labeling(\aEv)$
        % is a write, and $\Cdown{\aEv}=\aEvs_1$, otherwise,
      % \item \label{seq-kappa-release}
      %   if $\labeling_2(\aEv)$ is a $\srelease$ then $\labelingForm(\aEv) \riff \aTerm[1]$,
      \end{enumerate}
      \columnbreak
    \item \label{seq-tau}
      $\aTr{\bEvs}{\bForm} \riff \aTr[1]{\bEvs}{\aTr[2]{\bEvs}{\bForm}}$,
    \item \label{seq-term}
      $\aTerm \riff \aTerm[1]\land\aTr[1]{}{\aTerm[2]}$,
    \item \label{seq-le}
      ${\lt}\rextends{\lt_1}{\lt_2}$.
      % ${\lt}\supseteq{\lt_1}\cup{\lt_2}$.
    %   \stepcounter{enumi}
    % \item[] \labeltext[\textsc{s}6]{}{seq-le}
    %   \begin{enumerate}[leftmargin=0pt]
    %   \item \label{seq-le-subset}
    %     ${\lt}\supseteq{\lt_1}\cup{\lt_2}$,
    %   \item \label{seq-le-project}
    %     ${\lt_i}={\lt}\cap(\aEvs_i\times \aEvs_i)$, for $i\in\{1,2\}$.        
    %   \end{enumerate}
    \end{enumerate}
  \end{multicols}
  \medskip

  \noindent
  If $\aPS \in \sIF{\aForm}\sTHEN\aPSS_1\sELSE\aPSS_2\sFI$ then
  $(\exists\aPS_1\in\aPSS_1)$ $(\exists\aPS_2\in\aPSS_2)$
  \begin{multicols}{2}
    \begin{enumerate}[topsep=0pt,label=(\textsc{i}\arabic*),ref=\textsc{i}\arabic*]
    \item \label{if-E}
      $\aEvs = (\aEvs_1\cup\aEvs_2)$,
    \item \label{if-lambda}
      ${\labeling}=\PBR{{\labeling_1}\cup {\labeling_2}}$, 
      % \item[(\ref{par-E}--\ref{par-le})] as for $\sPAR{}{}$,
      \stepcounter{enumi}
    \item[] \labeltext[\textsc{i}3]{}{if-kappa}
      \begin{enumerate}[leftmargin=0pt]
      \item \label{if-kappa1}
        if $\aEv\in\aEvs_1\setminus\aEvs_2$ then $\labelingForm(\aEv) \riff \aForm\land\labelingForm_1(\aEv)$,
      \item \label{if-kappa2}
        if $\aEv\in\aEvs_2\setminus\aEvs_1$ then $\labelingForm(\aEv) \riff \neg\aForm\land\labelingForm_2(\aEv)$, 
      \item \label{if-kappa12}
        \makebox[0pt][l]{%
          if $\aEv\in\aEvs_1\cap\aEvs_2$ then
          % $\labelingForm(\aEv) \riff (\aForm\limplies\labelingForm_1(\aEv))\land(\neg\aForm\limplies\labelingForm_2(\aEv))$,
          $\labelingForm(\aEv) \riff (\aForm\land\labelingForm_1(\aEv))\lor(\neg\aForm\land\labelingForm_2(\aEv))$,
        }
      \end{enumerate}
      \columnbreak
    \item \label{if-tau}
      % $\aTr{\bEvs}{\bForm} \riff (\aForm\limplies\aTr[1]{\bEvs}{\bForm})\land(\neg\aForm\limplies\aTr[2]{\bEvs}{\bForm})$,
      % $\aTr{\bEvs}{\bForm} \riff \aForm\limplies\aTr[1]{\bEvs}{\neg\aForm\limplies\aTr[2]{\bEvs}{\bForm}}$,
      $\aTr{\bEvs}{\bForm} \riff (\aForm\land\aTr[1]{\bEvs}{\bForm})\lor(\neg\aForm\land\aTr[2]{\bEvs}{\bForm})$,
    \item \label{if-term}
      % $\aTerm \riff (\aForm\limplies\aTerm[1])\land(\neg\aForm\limplies\aTerm[2])$.
      $\aTerm \riff (\aForm\land\aTerm[1])\lor(\neg\aForm\land\aTerm[2])$,
    \item \label{if-le}
      ${\lt}\rextends{\lt_1}{\lt_2}$.
    %   ${\lt}\supseteq{\lt_1}\cup{\lt_2}$.
    %   \stepcounter{enumi}
    % \item[] \labeltext[\textsc{i}6]{}{if-le}
    %   \begin{enumerate}[leftmargin=0pt]
    %   \item \label{if-le-subset}
    %     ${\lt}\supseteq{\lt_1}\cup{\lt_2}$,
    %   \item \label{if-le-project}
    %     ${\lt_i}={\lt}\cap(\aEvs_i\times \aEvs_i)$, for $i\in\{1,2\}$.        
    %   \end{enumerate}
    \end{enumerate}
  \end{multicols}
  \medskip

  \noindent
  If $\aPS\in\sLET{\aReg}{\aExp}$ then $\aEvs = \emptyset$
  and $\aTr{\bEvs}{\bForm} \riff \bForm[\aExp/\aReg]$
  and $\aTerm\riff\TRUE$.
  
  \medskip

  \noindent
  If $\aPS \in \sSTORE[\amode]{\aLoc}[\ascope]{\aExp}[\aThrd]$ then
  $(\exists\aVal\in\Val)$
  \begin{multicols}{2}
    \begin{enumerate}[topsep=0pt,label=(\textsc{w}\arabic*),ref=\textsc{w}\arabic*]
    \item \label{write-E}
      $\fcard{\aEvs}\leq1$,
      %if $\bEv,\aEv\in\aEvs$ then $\bEv=\aEv$,
    \item \label{write-lambda}
      $\labelingAct(\aEv) = \DW[\amode]{\aLoc}[\ascope]{\aVal}[\aThrd]$,
    \item \label{write-kappa}
      \begin{math}
        \labelingForm(\aEv) \riff
        \aExp{=}\aVal
      \end{math},    
    % \item \label{write-tau}
    %   % if $(\aEvs\cap\bEvs)\neq\emptyset$ then
    %   \begin{math}
    %     \aTr{\bEvs}{\bForm} \riff 
    %     \bForm
    %     [\aExp/\aLoc]
    %     % \land\aExp{=}\aVal
    %   \end{math},
    \item \label{write-tau}
      %\makebox[0cm][l]{%
      \begin{math}
        \aTr{\bEvs}{\bForm} \riff 
        \bForm
        [\aExp/\aLoc][\kappaE{}/\Q{\aLoc}],
      \end{math}
    \item \label{write-term}
        $\aTerm \riff \kappaE{}$,
    %   \stepcounter{enumi}      
    % \item[] \labeltext[\textsc{w}4]{}{write-tau}
    %   \begin{enumerate}[leftmargin=0pt]
    %   \item \label{write-tau-nonempty}
    %     if $\aEvs\neq\emptyset$ then 
    %     \makebox[0cm][l]{%
    %     \begin{math}
    %       \aTr{\bEvs}{\bForm} \riff 
    %       \bForm
    %       [\aExp/\aLoc][\aExp{=}\aVal/\Q{\aLoc}],
    %     \end{math}}
    %   \item \label{write-tau-empty}
    %     if $\aEvs=\emptyset$ then 
    %     \begin{math}
    %       \aTr{\bEvs}{\bForm} \riff 
    %       \bForm
    %       [\aExp/\aLoc][\FALSE/\Q{\aLoc}],
    %     \end{math}
    %   \end{enumerate}
    %   \columnbreak
    %   \stepcounter{enumi}      
    % \item[] \labeltext[\textsc{w}5]{}{write-term}
    %   \begin{enumerate}[leftmargin=0pt]
    %   \item \label{write-term-nonempty}
    %     if $\aEvs\neq\emptyset$ then $\aTerm \riff \aExp{=}\aVal$,
    %   \item \label{write-term-empty}
    %     if $\aEvs=\emptyset$ then $\aTerm \riff \FALSE$.
    %   \end{enumerate}
    \end{enumerate}
  \end{multicols}
  \medskip

  \noindent
  If $\aPS \in \sLOAD[\amode]{\aReg}[\ascope]{\aLoc}[\aThrd]$ then
  $(\exists\aVal\in\Val)$
  \begin{multicols}{2}
    \begin{enumerate}[topsep=0pt,label=(\textsc{r}\arabic*),ref=\textsc{r}\arabic*]
    \item \label{read-E}
      $\fcard{\aEvs}\leq1$,
      %if $\bEv,\aEv\in\aEvs$ then $\bEv=\aEv$,
    \item \label{read-lambda}
      $\labelingAct(\aEv) = \DR[\amode]{\aLoc}[\ascope]{\aVal}[\aThrd]$,
    \item \label{read-kappa}
      %$\labelingForm(\aEv) \riff \TRUE$,
      $\labelingForm(\aEv) \riff \Q{\aLoc}$,
     \stepcounter{enumi}
    \item[] \labeltext[\textsc{r}4]{}{read-tau}
      \begin{enumerate}[leftmargin=0pt]
      \item \label{read-tau-dep}
        if $\aEv\in\aEvs\cap\bEvs$ then
        %if $\aEv\in\aEvs$ and $\aEv\in\bEvs$ then
        %if $\aEvs\neq\emptyset$ and $(\aEvs\cap\bEvs)\neq\emptyset$ then
        \makebox[0pt][l]{%
          \begin{math}
            \aTr{\bEvs}{\bForm} \riff
            (\labelingForm(\aEv)\limplies\aVal{=}\aReg)
            \limplies \bForm,
          \end{math}
        }
      \item \label{read-tau-ind}
        if $\aEv\in\aEvs\setminus\bEvs$ then
        %if $\aEv\in\aEvs$ and $\aEv\notin\bEvs$ then
        %if $\aEvs\neq\emptyset$ and $(\aEvs\cap\bEvs)=\emptyset$ then
        \makebox[0pt][l]{\begin{math}
          \aTr{\bEvs}{\bForm} \riff
          \PBR{
            \labelingForm(\aEv)
            \limplies
            \PBR{
              \aVal{=}\aReg \lor \aLoc{=}\aReg
            }
          }
          \limplies \bForm,
        \end{math}}
        \columnbreak
      \item \label{read-tau-empty}
        if $\aEvs=\emptyset$ then
        \begin{math}
          \aTr{\bEvs}{\bForm} \riff
          % \PBR{\aVal{=}\aReg \lor \aLoc{=}\aReg} \limplies
          \bForm,
        \end{math}
      \end{enumerate}
      \stepcounter{enumi}
    \item[] \labeltext[\textsc{r}5]{}{read-term}
      \begin{enumerate}[leftmargin=0pt]
      \item \label{read-term-nonempty}
        % if $\aEvs\neq\emptyset$ or $\amode\lemode\mRLX$ then $\aTerm \riff \TRUE$,
        if $\amode\lemode\mRLX$ then $\aTerm \riff \TRUE$,
      \item \label{read-term-empty}
        % if $\aEvs=\emptyset$ and $\amode\gemode\mACQ$ then $\aTerm \riff \FALSE$.
        if $\amode\gemode\mACQ$ then
        \begin{math}
          \aTerm \riff
          \kappaE{}. %\emptyForm.
          % \bigvee_{\aEv\in\aEvs}\aForm_\aEv.
        \end{math}
      \end{enumerate}      
    % \item \label{read-term}
    %   if $\aEvs=\emptyset$ and $\amode\gemode\mACQ$ then $\aTerm \riff \FALSE$. 
    \end{enumerate}
  \end{multicols}
  \medskip

  % \noindent
  % If $\aPS \in \sFENCE[\ascope]{\amode}[\aThrd]$ then
  % % $(\exists\aLocs\subseteq\Loc)$
  % % $(\exists\bmode\in\{\amode,\mRLX\})$
  % \begin{multicols}{2}
  %   \begin{enumerate}[topsep=0pt,label=(\textsc{f}\arabic*),ref=\textsc{f}\arabic*]
  %   \item \label{fence-E}
  %     % $\aEvs\neq\emptyset$ and
  %     if $\bEv,\aEv\in\aEvs$ then $\bEv=\aEv$,
  %   \item \label{fence-lambda}
  %     $\labelingAct(\aEv) = \DF[\ascope]{\amode}[\aThrd]$,
  %   \item \label{fence-kappa}
  %     $\labelingForm(\aEv) \riff \TRUE$,
  %   \item \label{fence-tau}
  %     $\aTr{\bEvs}{\bForm} \riff \bForm$,
  %     \stepcounter{enumi}      
  %   \item[] \labeltext[\textsc{f}5]{}{fence-term}
  %     \begin{enumerate}[leftmargin=0pt]
  %     \item \label{fence-term-nonempty}
  %       if $\aEvs\neq\emptyset$ then $\aTerm \riff \TRUE$,
  %     \item \label{fence-term-empty}
  %       if $\aEvs=\emptyset$ then $\aTerm \riff \FALSE$.
  %     \end{enumerate}
  %   % \item \label{fence-term}
  %   %   if $\aEvs=\emptyset$ then $\aTerm \riff \FALSE$.
  %   \end{enumerate}
  % \end{multicols}
  \vspace{-.5\baselineskip}
  \begin{align*}
    \begin{aligned}
      \sembase{\LET{\aReg}{\aExp}} &= \sLET{\aReg}{\aExp}
      \\
      \sembase{\PR[\amode]{\aLoc}{\aReg}} &= \sLOAD[\amode]{\aReg}[\ascope]{\aLoc}[\aThrd]
      \\
      \sembase{\PW[\amode]{\aLoc}{\aExp}} &= \sSTORE[\amode]{\aLoc}[\ascope]{\aExp}[\aThrd]
      % \\
      % \sembase{\PF[\ascope]{\fmode}} &= \sFENCE[\ascope]{\fmode}[\aThrd]
    \end{aligned}
    &&
    \begin{aligned}
      \sembase{\SKIP} &= \sSKIP 
      \\
      \sembase{\aCmd_1 \SEMI \aCmd_2} &= \sSEMI{\sembase{\aCmd_1}}{\sembase{\aCmd_2}}
      \\
      \sembase{\IF{\aExp}\THEN\aCmd_1\ELSE\aCmd_2\FI} &= \sIFTHEN{\aExp{\neq}0}{\sembase{\aCmd_1}}{\sembase{\aCmd_2}}
    \end{aligned}
  \end{align*}
  %\vspace{-.5\baselineskip}
  \caption{PwT Semantics}
  \label{fig:seq}
\end{figure}
